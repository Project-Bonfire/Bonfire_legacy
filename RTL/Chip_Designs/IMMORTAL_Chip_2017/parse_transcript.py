########################################################################
#	Copyright (C) 2016 Siavoosh Payandeh Azad
#	This script parses the transcript file generated by modelsim and
#	generates 3 files:
# 			* sent.txt: keeps the log of all the sent packets
# 			* received.txt: keeps the log of all the received packets
# 			* diagnosis.txt: keeps the log of all the diagnostic packets
# 	in case you turn off the reports in the network_files/NI.vhd , these
# 	reports can not be extracted out of transcript file
########################################################################
import sys
try:
	transcript_file = open('transcript', 'r')
	recieved_file = open('received.txt', 'w')
	sent_file = open('sent.txt', 'w')
	diagnosis_file = open('diagnosis.txt', 'w')
except IOError:
    print "Could not open input transcript file, sent file, received file or diagnosis file!"
    sys.exit()

sent_packet_counter = 0
received_packet_counter = 0
diagnostic_packet_counter = 0
for line in transcript_file:
	if line != '':
		if "Packet received" in line:
			recieved_file.write(line[11:])
			received_packet_counter += 1
		if "Packet generated" in line and "Diagnostic" not in line:
			sent_file.write(line[11:])
			sent_packet_counter += 1
		if "Diagnostic" in line:
			diagnosis_file.write(line[11:])
			diagnostic_packet_counter+=1
print "--------------------------------"
print "sent packets:", sent_packet_counter
print "received packets:", received_packet_counter
print "diagnostic packets:", diagnostic_packet_counter
print "--------------------------------"
print "packets not recieved:", sent_packet_counter-received_packet_counter+diagnostic_packet_counter
print "packet loss rate:", float(sent_packet_counter-received_packet_counter+diagnostic_packet_counter)/sent_packet_counter, " %"
print "--------------------------------"
recieved_file.close()
sent_file.close()
diagnosis_file.close()
